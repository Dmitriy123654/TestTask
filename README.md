# Test Task

## Описание

**TestTask** - это программа, предназначенная для поиска квартир на основе данных, полученных через API. Она включает функциональность для анализа цен за квадратный метр, поиска квартир в заданном полигоне и фильтрации по районам.

### Основные компоненты

#### program.cs:

**Описание методов**

- **Main**  
  Метод `Main` является точкой входа в программу. Он выполняет следующие действия:

  - Получает данные объявлений о продаже и аренде квартир с помощью метода `FetchData`.
  - Вызывает методы для выполнения трех заданий:
    - **AnalyzePricePerSquareMeter**: Анализ цены за квадратный метр для объявлений о продаже квартир.
    - **FindApartmentsInPolygon**: Поиск квартир, находящихся внутри заданного многоугольника.<span style="color: orange; text-decoration: underline;"> **Точки многоугольника задаются вручную в коде!**</span> 
    - **FindApartmentsInDistrict**: Поиск квартир в заданном районе с учетом даты заезда и выезда <span style="color: orange; text-decoration: underline;">**!!!Значения района, даты заезда и выезда задаются вручную в коде!!!**</span>.

- **FetchData**  
  Метод `FetchData` выполняет HTTP GET-запрос к указанному URL-адресу API Kufar.by и возвращает список объявлений (`List<Ad>`). Он использует `HttpClient` для выполнения запроса и `Newtonsoft.Json` для десериализации JSON-ответа.

- **AnalyzePricePerSquareMeter**  
  Метод `AnalyzePricePerSquareMeter` анализирует цену за квадратный метр для объявлений о продаже квартир. Он использует `PricePerSquareMeterAnalysisService` для выполнения анализа.

- **FindApartmentsInPolygon**  
  Метод `FindApartmentsInPolygon` ищет квартиры, находящиеся внутри заданного многоугольника. Он использует `SearchApartmentInClosedFigureService` для выполнения поиска.<span style="color: orange; text-decoration: underline;">**Точки многоугольника задаются вручную в коде**!</span> **Точки многоугольника задаются вручную в коде!**

- **FindApartmentsInDistrict**  
  Метод `FindApartmentsInDistrict` ищет квартиры в заданном районе с учетом дат заезда и выезда. Он использует `ApartmentSearchByCriteriaService` для выполнения поиска. <span style="color: orange; text-decoration: underline;">**Значения района, даты заезда и выезда задаются вручную в коде!**</span>

### services:

#### ApartmentSearchByCriteriaService

**Класс** `ApartmentSearchByCriteriaService` предоставляет функциональность для поиска квартир в заданном районе с учетом дат заезда и выезда.

- **Методы**:

  - **FindApartmentsInDistrict**  
    Метод `FindApartmentsInDistrict` выполняет поиск квартир в заданном районе с учетом дат заезда и выезда.

    - **Принимает**:
      - `ads (List)`: Список объявлений о квартирах.
      - `district (string)`: Название района для поиска.
      - `checkInDate (int)`: Идентификатор даты заезда.
      - `checkOutDate (int)`: Идентификатор даты выезда.
    - **Возвращает**: `void`
    - **Выводит**: Список доступных квартир, удовлетворяющих заданным критериям, с информацией об адресе, цене и количестве комнат.

  - **IsAvailableOnDates (приватный)**  
    Метод `IsAvailableOnDates` проверяет, доступна ли квартира в заданные даты заезда и выезда.

    - **Принимает**:
      - `ad (Ad)`: Объявление о квартире.
      - `checkInDateId (int)`: Идентификатор даты заезда.
      - `checkOutDateId (int)`: Идентификатор даты выезда.
    - **Возвращает**: `bool` - `true`, если квартира доступна в заданные даты, иначе `false`.

  - **PrintApartments**  
    Метод `PrintApartments` выводит список доступных квартир с информацией об адресе, цене и количестве комнат.
    - **Принимает**:
      - `apartments (List)`: Список доступных квартир.
    - **Возвращает**: `void`
    - **Выводит**: Информацию о доступных квартирах, включая адрес, цену и количество комнат.

#### PricePerSquareMeterAnalysisService

**Класс** `PricePerSquareMeterAnalysisService` предоставляет функциональность для анализа цены за квадратный метр квартир.

- **Методы**:

  - **Analyze**  
    Метод `Analyze` выполняет анализ цены за квадратный метр квартир.

    - **Принимает**:
      - `ads (List)`: Список объявлений о квартирах.
    - **Возвращает**: `void`
    - **Выводит**: Зависимость стоимости квадратного метра от этажа, количества комнат и ближайшей станции метро.

  - **EnsureSquareMeterExists (приватный)**  
    Метод `EnsureSquareMeterExists` проверяет наличие параметра "square_meter" (цена за квадратный метр) для каждого объявления и добавляет его, если он отсутствует.

    - **Принимает**:
      - `ads (List)`: Список объявлений о квартирах.
    - **Возвращает**: `void`

  - **PrintFloorPriceDependence (приватный)**  
    Метод `PrintFloorPriceDependence` выводит зависимость стоимости квадратного метра от этажа квартиры.

    - **Принимает**:
      - `ads (List)`: Список объявлений о квартирах.
    - **Возвращает**: `void`
    - **Выводит**: Зависимость стоимости квадратного метра от этажа квартиры.

  - **PrintRoomsPriceDependence (приватный)**  
    Метод `PrintRoomsPriceDependence` выводит зависимость стоимости квадратного метра от количества комнат.

    - **Принимает**:
      - `ads (List)`: Список объявлений о квартирах.
    - **Возвращает**: `void`
    - **Выводит**: Зависимость стоимости квадратного метра от количества комнат.

  - **PrintMetroPriceDependence (приватный)**  
    Метод `PrintMetroPriceDependence` выводит зависимость стоимости квадратного метра от ближайшей станции метро.
    - **Принимает**:
      - `ads (List)`: Список объявлений о квартирах.
    - **Возвращает**: `void`
    - **Выводит**: Зависимость стоимости квадратного метра от ближайшей станции метро.

#### SearchApartmentInClosedFigureService

**Класс** `SearchApartmentInClosedFigureService` предоставляет функциональность для поиска квартир, находящихся внутри заданной замкнутой фигуры.

- **Методы**:

  - **FindApartmentsInPolygon**  
    Метод `FindApartmentsInPolygon` выполняет поиск квартир, находящихся внутри заданной замкнутой фигуры.

    - **Принимает**:
      - `ads (List)`: Список объявлений о квартирах.
      - `polygonPoints (List<double[]>)`: Список точек, определяющих замкнутую фигуру.
    - **Возвращает**: `List` - Список квартир, находящихся внутри заданной замкнутой фигуры.
    - **Выводит**: `void`

  - **IsPolygonValid**  
    Метод `IsPolygonValid` проверяет, является ли заданный список точек допустимой замкнутой фигурой.

    - **Принимает**:
      - `polygonPoints (List<double[]>)`: Список точек, определяющих замкнутую фигуру.
    - **Возвращает**: `bool` - `true`, если заданный список точек представляет собой допустимую замкнутую фигуру, иначе `false`.

  - **IsPointInPolygon**  
    Метод `IsPointInPolygon` проверяет, находится ли заданная точка внутри замкнутой фигуры.

    - **Принимает**:
      - `x (double)`: Координата X точки.
      - `y (double)`: Координата Y точки.
      - `polygonPoints (List<double[]>)`: Список точек, определяющих замкнутую фигуру.
    - **Возвращает**: `bool` - `true`, если точка находится внутри замкнутой фигуры, иначе `false`.

  - **PrintResults**  
    Метод `PrintResults` выводит результаты поиска квартир внутри замкнутой фигуры.
    - **Принимает**:
      - `apartments (List)`: Список квартир, находящихся внутри замкнутой фигуры.
    - **Возвращает**: `void`
    - **Выводит**: Количество квартир в заданной фигуре и их идентификаторы (`AdId`).

### models:

#### -dto

### TestTask.Tests

Проект включает модульные тесты, которые проверяют функциональность поиска квартир. Ниже приведены тесты и их описания:

#### Тесты

- **FindApartmentsInPolygon_ValidPolygon_FindsApartments**  
  **Описание**: Проверяет, что метод `FindApartmentsInPolygon` корректно находит квартиры в валидном полигоне.

  - **Проверки**:
    - Убедимся, что найденные квартиры соответствуют ожидаемым ID (1 и 2).
    - Убедимся, что квартира с ID 3 не найдена.

- **FindApartmentsInPolygon_InvalidPolygon_ThrowsArgumentException**  
  **Описание**: Проверяет, что метод `FindApartmentsInPolygon` выбрасывает исключение, когда полигон задан некорректно (менее 3 точек).

  - **Проверки**:
    - Убедимся, что выбрасывается `ArgumentException` с ожидаемым сообщением.

- **FindApartmentsInPolygon_ValidPolygon_NoApartmentsFound**  
  **Описание**: Проверяет, что метод `FindApartmentsInPolygon` возвращает пустой список, если в валидном полигоне нет квартир.

  - **Проверки**:
    - Убедимся, что список найденных квартир пуст.

- **IsPolygonValid_InvalidPolygon_ReturnsFalse**  
  **Описание**: Проверяет, что метод `IsPolygonValid` корректно определяет недопустимый полигон.

  - **Проверки**:
    - Убедимся, что метод возвращает `false`.

- **IsPointInPolygon_ValidPoint_ReturnsTrue**  
  **Описание**: Проверяет, что метод `IsPointInPolygon` правильно определяет, что точка находится внутри полигона.

  - **Проверки**:
    - Убедимся, что метод возвращает `true` для точки внутри полигона.

- **IsPointInPolygon_InvalidPoint_ReturnsFalse**  
  **Описание**: Проверяет, что метод `IsPointInPolygon` правильно определяет, что точка находится снаружи полигона.
  - **Проверки**:
    - Убедимся, что метод возвращает `false` для точки вне полигона.
